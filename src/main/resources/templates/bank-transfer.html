<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PayMyBuddy - Bank Transfer</title>
  <link th:href="@{/css/style.css}" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

</head>
<body>
<div class="home-container">
  <div th:insert="menu">...</div>
  <div class="card">
    <h1>Welcome to PayMyBuddy</h1>
    <form>
      <div class="d-flex">
        <p><strong>Your sold is: &nbsp</strong></p>
        <p> </p>
        <p th:text=" ${sold}"></p>
        <p>â‚¬</p>
      </div>
      <div>
        <p>Transfer to: </p>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="selectRadio" value="bank" id="receiverBank">
          <label class="form-check-label" for="receiverBank">
            Bank Account
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="selectRadio" value="app" id="receivedApp">
          <label class="form-check-label" for="receivedApp">
            PayMyBuddy
          </label>
        </div>
      </div>
      <div class="form-group">
        <label for="amount">Amount</label>
        <input type="text" class="form-control" id="amount" aria-describedby="amountHelp" placeholder="0.0">
        <small id="amountHelp" class="form-text text-muted">The amount must be superior to 0.0</small>
      </div>
      <button type="submit" class="btn btn-primary" onclick="handleSubmit()">Send</button>
    </form>
  </div>
</div>
</body>
</html>

<script>
  const handleSubmit = () => {
      let element = document.getElementsByName('selectRadio');
      let select = null;
      for(let i = 0; i < element.length; i++) {
        if(element[i].checked) {
          select = element[i].value
        }
      }
    let amount = document.getElementById("amount").value;
    let URL = select === "app" ? 'http://localhost:8080/api/v1/banktransaction/to?amount=' + amount :
            'http://localhost:8080/api/v1/banktransaction/from?amount=' + amount;

    fetch(URL, {
      method: 'POST',
    })
            .then(res => res.text())
            .then(() => openNewWindow())
  }

  const openNewWindow = () => {
    window.open("http://localhost:8080/transfer", "_self")
  }
</script>

